var Flexie=function(A,E){function F(a){if(a)a=a.replace(wa,y).replace(xa,y);return a}function k(a,d){var c,b=0,e=a?a.length:S;if(e===S)for(c in a){if(a.hasOwnProperty(c))if(d.call(a[c],c,a[c])===M)break}else for(c=a[0];b<e&&d.call(c,b,c)!==M;c=a[++b]);}function ya(){var a;k({NW:"*.Dom.select",DOMAssistant:"*.$",Prototype:"$$",YAHOO:"*.util.Selector.query",MooTools:"$$",Sizzle:"*",jQuery:"*",dojo:"*.query"},function(d,c){if(A[d]&&!a&&(a=eval(c.replace("*",d))))T=d});return a}function Y(a,d){a="on"+
a;var c=A[a];A[a]=typeof A[a]!=="function"?d:function(){c&&c();d()}}function Z(a){var d=a.nodeName.toLowerCase();if(a.id)d+="#"+a.id;else if(a.FLX_DOM_ID)d+="["+$+"='"+a.FLX_DOM_ID+"']";return d}function U(a){a.FLX_DOM_ID=a.FLX_DOM_ID||++aa;a.setAttribute($,a.FLX_DOM_ID)}function za(a){var d=[],c,b,e,f,g,h;a=a.replace(Aa,y);a=a.replace(/\s?(\{|\:|\})\s?/g,P);a=a.split(ba);k(a,function(l,m){if(m){c=[m,ba].join(y);if((b=/(.*)\{(.*)\}/.exec(c))&&b[2]){e=b[1];f=b[2].split(";");h=[];k(f,function(p,s){g=
s.split(":");g.length&&g[1]&&h.push({property:g[0],value:g[1]})});e&&h.length&&d.push({selector:e,properties:h})}}});return d}function Ba(a){var d,c,b,e,f,g=/(\s)?,(\s)?/,h,l,m,p={},s={};h=function(t,n){var o=s[t];n.selector=F(n.selector);k(n.properties,function(q,u){u.property=F(u.property);u.value=F(u.value)});if(o)o.properties.push(n);else s[t]=n};k(a,function(t,n){d=F(n.selector);c=n.properties;k(c,function(o,q){b=F(q.property);e=F(q.value);if(b){f=b.replace("box-",y);switch(f){case "display":e===
"box"&&h(d,n);break;case "orient":case "align":case "direction":case "pack":h(d,n);break;case "flex":case "flex-group":case "ordinal-group":l=d.split(g);k(l,function(u,x){if(x&&(x=F(x)))if(p[x])p[x][f]=e;else{m={};k(n,function(B){m[B]=n[B]});m.selector=x;m[f]=e;p[x]=m}})}}})});k(s,function(t,n){G.push(n)});k(p,function(t,n){ca.push(n)});return{boxes:G,children:ca}}function da(a,d,c){var b,e,f=[];k(c,function(g,h){if(h.selector){b=d(h.selector);b[0]&&k(b,function(l,m){switch(m.nodeName.toLowerCase()){case "script":case "style":case "link":break;
default:if(m.parentNode===a){U(m);e={};k(h,function(p){e[p]=h[p]});e.match=m;f.push(e)}}})}else{U(h);f.push({match:h,selector:Z(h)})}});return f}function Ca(a){k(a,function(d,c){a[d]=c||Da[d]});return a}function Ea(a){var d,c,b,e,f,g,h,l,m,p,s,t,n,o,q={},u,x,B;if(a){k(a.boxes,function(V,w){w.selector=F(w.selector);d=w.selector;c=w.properties;g=h=l=m=p=C;k(c,function(Fa,H){b=F(H.property);e=F(H.value);if(b){f=b.replace("box-",y);switch(f){case "display":if(e==="box")g=e;break;case "orient":h=e;break;
case "align":l=e;break;case "direction":m=e;break;case "pack":p=e}}});s=J;t=s(w.selector);t=t[0]?t:[t];k(t,function(Fa,H){if(H.nodeType){U(H);n=da(H,s,a.children);B=d+" [data-flexie-parent]";o={target:H,selector:d,properties:c,children:n,display:g,orient:h,align:l,direction:m,pack:p,nested:B};if(u=q[H.FLX_DOM_ID])k(o,function(K,N){switch(K){case "selector":if(N&&!RegExp(N).test(u[K]))u[K]+=N;break;case "children":k(o[K],function(Xa,ea){x=M;k(u[K],function(Ya,Ga){if(ea.match.FLX_DOM_ID===Ga.match.FLX_DOM_ID)x=
r});x||u[K].push(ea)});break;default:if(N)u[K]=N}});else{q[H.FLX_DOM_ID]=Ca(o);q[H.FLX_DOM_ID].target.setAttribute("data-flexie-parent",true)}}})});fa=J("[data-flexie-parent]");G={};k(fa,function(V,w){G[w.FLX_DOM_ID]=q[w.FLX_DOM_ID]});k(G,function(V,w){w.display==="box"&&new z.box(w)})}}function ga(a,d,c){c=c.replace(c.charAt(0),c.charAt(0).toUpperCase());var b=a["offset"+c]||0;b&&k(d,function(e,f){f=parseFloat(a.currentStyle[f]);isNaN(f)||(b-=f)});return b}function ha(a,d){var c,b,e=a.currentStyle&&
a.currentStyle[d],f=a.style;if(!ia.test(e)&&Ha.test(e)){c=f.left;b=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;f.left=e||0;e=f.pixelLeft+"px";f.left=c||0;a.runtimeStyle.left=b}return e}function v(a,d,c){if(A.getComputedStyle)a=A.getComputedStyle(a,C)[d];else{if(Ia.test(d)){var b=a&&a.currentStyle?a.currentStyle[d]:0;if(!ia.test(b)){if(b==="auto"||b==="medium"){b=b;switch(d){case "width":b=[ja,ka,la,ma];b=ga(a,b,d);break;case "height":b=[W,na,oa,pa];b=ga(a,b,d);break;default:b=ha(a,
d)}a=b}else a=ha(a,d);b=a}a=b}else a=a.currentStyle[d];a=a}a=a;if(c){a=parseInt(a,10);if(isNaN(a))a=0}return a}function Ja(a){return a.innerWidth||a.clientWidth}function Ka(a){return a.innerHeight||a.clientHeight}function X(a,d,c,b){var e=[];k(La,function(f,g){e.push((b?g:y)+d+":"+(!b?g:y)+c)});a.style.cssText+=e.join(";");return a}function D(a,d,c){k(a&&a[0]?a:[a],function(b,e){if(e&&e.style)e.style[d]=c?c+"px":y})}function Ma(a,d){var c,b,e;c=a.replace(Na,function(f,g){return"%"+g}).replace(/\s|\>|\+|\~/g,
"%").split(/%/g);b={_id:100,_class:10,_tag:1};e=d||0;k(c,function(f,g){if(/#/.test(g))e+=b._id;else if(/\.|\[|\:/.test(g))e+=b._class;else if(/[a-zA-Z]+/.test(g))e+=b._tag});return e}function Oa(a,d,c){var b=[],e,f=(c?"ordinal":"flex")+"Specificity";k(a,function(g,h){if(!c&&h.flex||c&&h["ordinal-group"]){h[f]=h[f]||Ma(h.selector);e=false;k(b,function(l,m){if(m.match===h.match){if(m[f]<h[f])b[l]=h;e=true;return false}});e||b.push(h)}});return b}function Q(a,d,c){var b={},e=[],f=0,g;a=Oa(a,d,c);k(d,
function(h,l){k(a,function(m,p){if(c){g=p["ordinal-group"]||"1";if(p.match===l){p.match.setAttribute("data-ordinal-group",g);b[g]=b[g]||[];b[g].push(p)}}else{g=p.flex||"0";if(p.match===l&&(!p[g]||p[g]&&parseInt(p[g],10)<=1)){f+=parseInt(g,10);b[g]=b[g]||[];b[g].push(p)}}});if(c&&!l.getAttribute("data-ordinal-group")){g="1";l.setAttribute("data-ordinal-group",g);b[g]=b[g]||[];b[g].push({match:l})}});k(b,function(h){e.push(h)});e.sort(function(h,l){return l-h});return{keys:e,groups:b,total:f}}function qa(a,
d,c){var b,e;k(a.childNodes,function(f,g){for(b=b||g.offsetTop-v(g,c.anti.pos,r);(e=v(g,c.props.dim,r))&&g.offsetTop-v(g,c.anti.pos,r)!==b;)g.style[c.props.dim]=e-1})}function Pa(a,d){L.push({construct:a,params:d});if(!ra){var c,b,e,f,g=E.body,h=E.documentElement;Y("resize",function(){e=A.innerWidth||h.innerWidth||h.clientWidth||g.clientWidth;f=A.innerHeight||h.innerHeight||h.clientHeight||g.clientHeight;if(c!==e||b!==f){z.updateInstance();c=e;b=f}});ra=r}}function sa(a){var d,c;k(a,function(b,e){d=
e.style.width;c=e.style.height;e.style.cssText=y;e.style.width=d;e.style.height=c})}function O(a,d){var c=[],b;i=0;for(j=d.length;i<j;i++)if(b=d[i])switch(b.nodeName.toLowerCase()){case "script":case "style":case "link":break;default:if(b.nodeType===1)c.push(b);else if(b.nodeType===3&&(b.isElementContentWhitespace||Qa.test(b.data))){a.removeChild(b);i--}}return c}function ta(a){var d=0;a=a.parentNode;for(var c;a.FLX_DOM_ID;){c=G[a.FLX_DOM_ID];c=Q(c.children,O(a,a.childNodes));d+=c.total;c=true;a=
a.parentNode}return{nested:c,flex:d}}function Ra(a,d){var c=a.parentNode,b;if(c.FLX_DOM_ID){c=G[c.FLX_DOM_ID];k(c.properties,function(e,f){if(RegExp(d).test(f.property)){b=true;return false}})}return b}function Sa(a){a.flexMatrix&&k(a.children,function(d,c){c.flex=a.flexMatrix[d]});a.ordinalMatrix&&k(a.children,function(d,c){c["ordinal-group"]=a.ordinalMatrix[d]});return a}function Ta(a){var d=a.target;if(!d.FLX_DOM_ID)d.FLX_DOM_ID=d.FLX_DOM_ID||++aa;if(!a.nodes)a.nodes=O(d,d.childNodes);if(!a.selector){a.selector=
Z(d);d.setAttribute("data-flexie-parent",r)}if(!a.properties)a.properties=[];if(!a.children)a.children=da(d,J,O(d,d.childNodes));if(!a.nested)a.nested=a.selector+" [data-flexie-parent]";a.target=d;return a}var z={},aa=0,$="data-flexie-id",I,T,J,ia=/^-?\d+(?:px)?$/i,Ha=/^-?\d/,Ia=/width|height|margin|padding|border/,Ua=/(msie) ([\w.]+)/,Aa=/\t|\n|\r/g,Va=/^max\-([a-z]+)/,Wa=/^https?:\/\//i,wa=/^\s\s*/,xa=/\s\s*$/,Qa=/^\s*$/,Na=/\s?(\#|\.|\[|\:(\:)?[^first\-(line|letter)|before|after]+)/g,y="",ua=" ",
P="$1",ka="paddingRight",na="paddingBottom",ja="paddingLeft",W="paddingTop",ma="borderRightWidth",pa="borderBottomWidth",la="borderLeftWidth",oa="borderTopWidth",ba="}",La=" -o- -moz- -ms- -webkit- -khtml- ".split(ua),Da={orient:"horizontal",align:"stretch",direction:"inherit",pack:"start"},G=[],ca=[],L=[],fa,ra,r=true,M=false,C=null,S=undefined,R={IE:function(){var a,d=Ua.exec(A.navigator.userAgent.toLowerCase());if(d)a=parseInt(d[2],10);return a}()},va;va=function(){function a(n){return n.replace(l,
function(o,q,u){o=u.split(",");k(o,function(x,B){B.replace(m,P).replace(p,P).replace(t,P).replace(s,ua)});return q+o.join(",")})}function d(){if(A.XMLHttpRequest)return new A.XMLHttpRequest;try{return new A.ActiveXObject("Microsoft.XMLHTTP")}catch(n){return C}}function c(n){var o=d();o.open("GET",n,M);o.send();return o.status===200?o.responseText:y}function b(n,o){if(n){if(Wa.test(n))return o.substring(0,o.indexOf("/",8))===n.substring(0,n.indexOf("/",8))?n:C;if(n.charAt(0)==="/")return o.substring(0,
o.indexOf("/",8))+n;var q=o.split("?")[0];if(n.charAt(0)!=="?"&&q.charAt(q.length-1)!=="/")q=q.substring(0,q.lastIndexOf("/")+1);return q+n}}function e(n){if(n)return c(n).replace(f,y).replace(g,function(o,q,u){return e(b(u,n))}).replace(h,function(o,q,u){q=q||y;return" url("+q+b(u,n)+q+") "});return y}var f=/(\/\*[^*]*\*+([^\/][^*]*\*+)*\/)\s*/g,g=/@import\s*(?:url\(\s*?)?(["'])?(.*?)\1\s*\)?[\w\W]*?;/g,h=/\surl\((["'])?([^"')]+)\1\)/g,l=/(^|\})\s*([^\{]*?[\[:][^\{]+)/g,m=/([(\[+~])\s+/g,p=/\s+([)\]+~])/g,
s=/\s+/g,t=/^\s*((?:[\S\s]*\S)?)\s*$/;return function(){var n,o,q;o=E.getElementsByTagName("BASE");var u=o.length>0?o[0].href:E.location.href,x;o=0;for(q=E.styleSheets.length;o<q;o++)if((n=E.styleSheets[o])&&n.href!==C)if(n=b(n.href,u)){x=a(e(n));x=za(x);x=Ba(x)}Ea(x)}}();z.box=function(a){this.renderModel(a)};z.box.prototype={properties:{boxModel:function(a,d,c){var b;a.style.display="block";if(!c.cleared){d=c.selector;b=E.styleSheets;b=b[b.length-1];a="padding-top:"+(v(a,W,C)||"0.1px;");if(b.addRule)if(R.IE===
6)b.addRule(d,a+"zoom:1;",0);else R.IE===7?b.addRule(d,a+"display:inline-block;",0):b.addRule(d+":after","content:' ';display:block;margin:0;padding:0;border:0;height:0;background:none;clear:both;font-size:0;visibility:hidden",0);else if(b.insertRule){b.insertRule(d+"{"+a+"}",0);b.insertRule(d+":after{content:' ';display:block;margin:0;padding:0;border:0;height:0;background:none;clear:both;font-size:0;visibility:hidden}",0)}c.cleared=r}},boxDirection:function(a,d,c){var b;if(c.direction==="reverse"&&
!c.reversed||c.direction==="normal"&&c.reversed){d=d.reverse();k(d,function(e,f){a.appendChild(f)});d=J(c.nested);k(d,function(e,f){if((b=G[f.FLX_DOM_ID])&&b.direction==="inherit")b.direction=c.direction});c.reversed=!c.reversed}},boxOrient:function(a,d,c){var b;a={pos:"marginLeft",opp:"marginRight",dim:"width",out:"offsetWidth",func:Ja,pad:[ja,ka,la,ma]};b={pos:"marginTop",opp:"marginBottom",dim:"height",out:"offsetHeight",func:Ka,pad:[W,na,oa,pa]};I||k(d,function(e,f){f.style[R.IE>=9?"cssFloat":
"styleFloat"]="left";if(c.orient==="vertical")f.style.clear="left";if(R.IE===6)f.style.display="inline"});switch(c.orient){case "vertical":case "block-axis":this.props=b;this.anti=a;break;default:this.props=a;this.anti=b}},boxOrdinalGroup:function(a,d,c){var b,e;if(d.length){b=function(f){f=f.keys;k(c.reversed?f:f.reverse(),function(g,h){k(d,function(l,m){h===m.getAttribute("data-ordinal-group")&&a.appendChild(m)})})};e=Q(c.children,d,true);e.keys.length>1&&b(e)}},boxFlex:function(a,d,c){var b=this,
e,f,g,h;if(d.length){e=function(l){var m=l.groups,p;k(l.keys,function(s,t){k(m[t],function(n,o){p=C;k(o.properties,function(q,u){if(Va.test(u.property))p=parseFloat(u.value)});if(!p||o.match[b.props.out]>p)D(o.match,b.props.pos,C)})})};f=function(l){var m=0,p;k(d,function(s,t){m+=v(t,b.props.dim,r);k(b.props.pad,function(n,o){m+=v(t,o,r)});m+=v(t,b.props.pos,r);m+=v(t,b.props.opp,r)});p=a[b.props.out]-m;k(b.props.pad,function(s,t){p-=v(a,t,r)});return{whitespace:p,ration:p/l.total}};g=function(l,
m){var p=l.groups,s,t,n=m.ration,o,q,u;k(l.keys,function(x,B){o=n*B;k(p[B],function(V,w){if(w.match){s=w.match.getAttribute("data-flex");t=w.match.getAttribute("data-specificity");if(!s||t<=w.flexSpecificity){w.match.setAttribute("data-flex",B);w.match.setAttribute("data-specificity",w.flexSpecificity);q=v(w.match,b.props.dim,r);if(c.orient==="horizontal"){q+=v(a,b.props.pos,r);q+=v(a,b.props.opp,r)}u=Math.max(0,q+o);D(w.match,b.props.dim,u)}}});c.orient==="horizontal"&&qa(a,c,b)})};h=Q(c.children,
d);if(h.total){e(h);e=f(h);g(h,e)}}},boxAlign:function(a,d,c){var b=this,e,f,g=ta(a);if(!I&&!g.flex){Ra(a,b.anti.dim)||D(a,b.anti.dim,C);D(d,b.anti.dim,C)}e=a[b.anti.out];k(b.anti.pad,function(h,l){e-=v(a,l,r)});switch(c.align){case "start":break;case "end":k(d,function(h,l){f=e-l[b.anti.out];f-=v(l,b.anti.opp,r);D(l,b.anti.pos,f)});break;case "center":k(d,function(h,l){f=(e-l[b.anti.out])/2;D(l,b.anti.pos,f)});break;default:k(d,function(h,l){switch(l.nodeName.toLowerCase()){case "button":case "input":case "select":break;
default:var m=0;k(b.anti.pad,function(p,s){m+=v(l,s,r);m+=v(a,s,r)});l.style[b.anti.dim]="100%";f=l[b.anti.out]-m;D(l,b.anti.dim,C);f=e;f-=v(l,b.anti.pos,r);k(b.anti.pad,function(p,s){f-=v(l,s,r)});f-=v(l,b.anti.opp,r);f=Math.max(0,f);D(l,b.anti.dim,f)}})}},boxPack:function(a,d,c){var b=this,e=0,f=0,g=0,h,l,m;m=d.length-1;k(d,function(p,s){e+=s[b.props.out];e+=v(s,b.props.pos,r);e+=v(s,b.props.opp,r)});f=v(d[0],b.props.pos,r);h=a[b.props.out]-e;k(b.props.pad,function(p,s){h-=v(a,s,r)});if(h<0)h=Math.max(0,
h);switch(c.pack){case "end":D(d[0],b.props.pos,g+f+h);break;case "center":if(g)g/=2;D(d[0],b.props.pos,g+f+h/2);break;case "justify":f=Math.floor((g+h)/m);m=f*m-h;for(g=d.length-1;g;){kid=d[g];l=f;if(m){l++;m++}l=v(kid,b.props.pos,r)+l;D(kid,b.props.pos,l);g--}}if((c.pack==="end"||c.pack==="justify")&&c.orient==="horizontal")qa(a,c,b)}},setup:function(a,d,c){var b=this,e,f;if(!(!a||!d||!c))if(I&&I.partialSupport){e=Q(c.children,d);f=ta(a);d=O(a,a.childNodes);b.properties.boxOrient.call(b,a,d,c);
if((!e.total||!J(c.nested).length)&&(!f.nested||!f.flex)){c.align==="stretch"&&!I.boxAlignStretch&&b.properties.boxAlign.call(b,a,d,c);c.pack==="justify"&&!I.boxPackJustify&&b.properties.boxPack.call(b,a,d,c)}}else I||k(b.properties,function(g,h){h.call(b,a,O(a,a.childNodes),c)})},trackDOM:function(a){Pa(this,a)},updateModel:function(a){var d=a.target,c=a.nodes;sa(c);if(a.flexMatrix||a.ordinalMatrix)a=Sa(a);this.setup(d,c,a);this.bubbleUp(d,a)},renderModel:function(a){var d=this,c=a.target,b=c.childNodes;
if(c.length||b){a=Ta(a);d.updateModel(a);A.setTimeout(function(){d.trackDOM(a)},0)}},bubbleUp:function(a,d){for(var c,b=d.target.parentNode;b;){if(c=G[b.FLX_DOM_ID]){sa(c.nodes);this.setup(c.target,c.nodes,c)}b=b.parentNode}}};z.updateInstance=function(a,d){var c;k(L,function(b,e){if(!a||e&&e.params&&e.params.target.FLX_DOM_ID===a.FLX_DOM_ID){k(d,function(f,g){if(g!==S)e.params[f]=g});e.construct.updateModel(e.params);c=true}});if(d&&!c)c=new z.box(d)};z.getInstance=function(a){return G[a.FLX_DOM_ID]};
z.destroyInstance=function(a){var d=L;k(L,function(c,b){if(b&&b.params&&b.params.target===a){b.params.target.FLX_DOM_ID=null;b.params.target.style.cssText=y;k(b.params.children,function(e,f){f.match.style.cssText=y});d=L.splice(c,1)}});L=d};z.flexboxSupport=function(){var a={},d,c=E.createElement("flxbox"),b,e,f;c.style.width=c.style.height="100px";for(b=0;b<3;b++)c.innerHTML+='<b style="margin: 0; padding: 0; display:block; width: 10px; height:50px"></b>';X(c,"display","box");X(c,"box-align","stretch",
r);X(c,"box-pack","justify",r);E.body.appendChild(c);d=c.firstChild.offsetHeight;b={boxAlignStretch:function(){return d===100},boxPackJustify:function(){var g=0,h,l,m;h=0;for(l=c.childNodes.length;h<l;h++){m=c.childNodes[h];g+=m.offsetLeft}return g===135}};for(e in b){f=b[e]();if(!f)a.partialSupport=true;a[e]=f}E.body.removeChild(c);return~c.style.display.indexOf("box")?a:M};z.init=function(){z.flexboxSupported=I=z.flexboxSupport();J=ya();if((!I||I.partialSupport)&&J)va()};z.version=0.9;(function(a){var d,
c;if((c={DOMAssistant:["*.DOMReady","%"],Prototype:["document.observe","'dom:loaded', %"],YAHOO:["*.util.Event","onDOMReady","%"],MooTools:["window.addEvent","'domready', %"],jQuery:["*(document).ready","%"],dojo:["*.addOnLoad","%"]}[T])&&(d=eval(c[0].replace("*",T)))){if(c[2])d=d[c[1]];try{eval(d+"("+c[c.length-1].replace("%",a)+")")}catch(b){}}Y("load",function(){!d&&a&&a();z.updateInstance()})})(z.init);return z}(this,document);window.Flexie=Flexie;Flexie.version=Flexie.version;
Flexie.updateInstance=Flexie.updateInstance;Flexie.getInstance=Flexie.getInstance;Flexie.destroyInstance=Flexie.destroyInstance;Flexie.flexboxSupported=Flexie.flexboxSupported;
